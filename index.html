<html>
  <head>
      <meta charset="UTF-8">
  </head>
  <body>
     
    <button id="dialog_restart">Start dialog</button>
    <button id="dialog_stop">Stop dialog</button>

    <label for="number_to_calculate">Zadejte číslo:</label>
    <input type="number" id="number_to_calculate" name="number_to_calculate" required
        min="0" max="1000">
    <button id="send_number">Moc mocni</button>

    <audio id="audioout"></audio>

    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="https://cak.zcu.cz:9444/speechcloud.js"></script>
    <script src="require.js"></script>

    <style>
        body {
            font-family: verdana, helvetica;
        }

        #form {
            display: none;
        }

        #form input[type=text] {
            border-radius: 6px;
            -moz-border-radius: 6px;
            -webkit-border-radius: 6px;
        }

        .embedded {
            margin: 0px;
            padding: 0px;
        }

        .center {
            margin-left: auto;
            margin-right: auto;
            width: 50%;
            padding: 10px;
        }
        .flex-container {
            height: 100%;
    padding: 0;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
        }
    </style>
<script>

// SIP session, tj. hovor
var session;

// Výchozí URI, odkud se stáhne konfigurace ASR+TTS
var SPEECHCLOUD_URI = " https://cak.zcu.cz:9443/v1/speechcloud/devel_polakf_mocniny";
var SPEECHCLOUD_DEFAULT_APP_ID = "numbers";

// Proměnná pro udržení odkazu na řídící WebSocket
var SPEECHCLOUD_WS = null;

/* Výběr prvků z pole */
function choose(choices) {
  var index = Math.floor(Math.random() * choices.length); return choices[index];
}

/* Logovací funkce */
// function hlog(text) {
//     $("#log").prepend("<div>"+text+"<br/></div>");
// }


$( document ).ready(function() {

    $("#send_number").click(function () {
        var number_to_square = document.getElementById("number_to_calculate").value
        var number_to_say = parseInt(number_to_square*number_to_square, 10)
        do_tts(number_to_say, "Katerina210")
        document.getElementById("number_to_calculate").value = 0
    });

    /* Stavová proměnná a funkce pro spuštění/pozastavení rozpoznávání */
    var recognizing = false;

    function do_recognize() {
        if (!recognizing) {
            speechCloud.asr_recognize();
            recognizing = true;
        };
    }

    function do_pause() {
        if (recognizing) {
            speechCloud.asr_pause();
            recognizing = false;
        }
    }

    /* Přerušení syntézy zasláním zprávy tts_stop */
    function do_tts_stop() {
        console.log("Sending tts_stop");
        speechCloud.tts_stop();
    }

    /* Syntéza řeči */
    function do_tts(text, voice) {
        console.log("doing tts: ", text, voice)
        speechCloud.tts_synthesize({
            text: text,
            voice: voice
        });
    }

    /* Obsluha tlačítka Restart dialog */
    $("#dialog_restart").click(function () {
        location.reload(true);
    });

    /* Obsluha tlačítka Stop dialog*/
    $("#dialog_stop").click(function () {
        speechCloud.terminate();
    });

    var ignore_space = false;
    /* Po stisk mezerníku je totéž jako stisknutí tlačítka #send_message_empty */
    $(window).keydown(function(evt) {
        if (ignore_space) return;

        if (evt.keyCode == 32) {
            evt.preventDefault();
        };
    });

    $(window).keyup(function(evt) {
        if (ignore_space) return;

        if (evt.keyCode == 32) {
            setTimeout(function () {$("#send_message_empty").click()}, 100);
            evt.preventDefault();
        };
    });

    /* Proměnná, do které se uloží timeout pro SIP zavolání */
    var call_timeout = null;

    var model_uri = " https://cak.zcu.cz:9443/v1/speechcloud/F54AC144-8AE0-4315-98B0-B47C4CA1B580"
    var options = {
        uri: model_uri,
        tts: "#audioout",
        disable_audio_processing: true
    }

    var speechCloud = new SpeechCloud(options);

    window.speechCloud = speechCloud

   
    speechCloud.on('_ws_session', function () {
        console.log("ws connected")
        
    });
    speechCloud.on('asr_ready', function () {
        console.log("asr ready")
    });

    /* Při příchodu ASR výsledku */
    speechCloud.on('asr_result', function (msg) {
        if (msg.partial_result) {
            return;
        }
        if(msg.result == ""){
            return;
        }

    });
    speechCloud.on('dm_display', function(msg){
        console.log(msg)
    });


    
    speechCloud.init();

});

</script> 

  </body>
</html>

